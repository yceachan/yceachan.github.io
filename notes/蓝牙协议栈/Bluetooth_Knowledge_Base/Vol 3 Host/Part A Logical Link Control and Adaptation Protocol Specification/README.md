# Part A: Logical Link Control and Adaptation Protocol Specification

**Start Page:** 1084

## Table of Contents

- 1 Introduction (Page 1090)
  - 1.1 L2CAP features (Page 1090)
  - 1.2 Assumptions (Page 1093)
  - 1.3 Scope (Page 1094)
  - 1.4 Terminology (Page 1094)
- 2 General operation (Page 1098)
  - 2.1 Channel identifiers (Page 1098)
  - 2.2 Operation between devices (Page 1101)
  - 2.3 Operation between layers (Page 1102)
  - 2.4 Modes of operation (Page 1103)
  - 2.5 Mapping channels to logical links (Page 1105)
- 3 Data packet format (Page 1106)
  - 3.1 Connection-oriented channels in Basic L2CAP mode (Page 1106)
  - 3.2 Connectionless data channel in Basic L2CAP mode (Page 1107)
  - 3.3 Connection-oriented channel in Retransmission/Flow Control/Streaming modes (Page 1108)
    - 3.3.1 L2CAP header fields (Page 1108)
    - 3.3.2 Control field (Page 1109)
    - 3.3.3 L2CAP SDU Length field (2 octets) (Page 1113)
    - 3.3.4 Information Payload field (Page 1113)
    - 3.3.5 Frame Check Sequence (2 octets) (Page 1113)
    - 3.3.6 Invalid Frame Detection (Retransmission and Flow Control modes) (Page 1114)
    - 3.3.7 Invalid Frame Detection algorithm (Page 1115)
  - 3.4 Connection-oriented channels in LE Credit Based Flow Control mode and Enhanced Credit Based Flow Control mode (Page 1116)
    - 3.4.1 L2CAP Header fields (Page 1116)
    - 3.4.2 L2CAP SDU Length field (2 octets) (Page 1117)
    - 3.4.3 Information Payload field (Page 1117)
- 4 Signaling packet formats (Page 1118)
  - 4.1 L2CAP_COMMAND_REJECT_RSP (code 0x01) (Page 1121)
  - 4.2 L2CAP_CONNECTION_REQ (code 0x02) (Page 1122)
  - 4.3 L2CAP_CONNECTION_RSP (code 0x03) (Page 1123)
  - 4.4 L2CAP_CONFIGURATION_REQ (code 0x04) (Page 1125)
  - 4.5 L2CAP_CONFIGURATION_RSP (code 0x05) (Page 1127)
  - 4.6 L2CAP_DISCONNECTION_REQ (code 0x06) (Page 1130)
  - 4.7 L2CAP_DISCONNECTION_RSP (code 0x07) (Page 1130)
  - 4.8 L2CAP_ECHO_REQ (code 0x08) (Page 1131)
  - 4.9 L2CAP_ECHO_RSP (code 0x09) (Page 1131)
  - 4.10 L2CAP_INFORMATION_REQ (code 0x0A) (Page 1132)
  - 4.11 L2CAP_INFORMATION_RSP (code 0x0B) (Page 1133)
  - 4.12 Extended Feature Mask (Page 1134)
  - 4.13 Fixed Channels Supported over BR/EDR (Page 1135)
  - 4.14 [This section is no longer used] (Page 1136)
  - 4.15 [This section is no longer used] (Page 1136)
  - 4.16 [This section is no longer used] (Page 1136)
  - 4.17 [This section is no longer used] (Page 1136)
  - 4.18 [This section is no longer used] (Page 1136)
  - 4.19 [This section is no longer used] (Page 1136)
  - 4.20 L2CAP_CONNECTION_PARAMETER_UPDATE_REQ (code 0x12) (Page 1136)
  - 4.21 L2CAP_CONNECTION_PARAMETER_UPDATE_RSP (code 0x13) (Page 1137)
  - 4.22 L2CAP_LE_CREDIT_BASED_CONNECTION_REQ (code 0x14) (Page 1138)
  - 4.23 L2CAP_LE_CREDIT_BASED_CONNECTION_RSP (code 0x15) (Page 1139)
  - 4.24 L2CAP_FLOW_CONTROL_CREDIT_IND (code 0x16) (Page 1141)
  - 4.25 L2CAP_CREDIT_BASED_CONNECTION_REQ (code 0x17) (Page 1142)
  - 4.26 L2CAP_CREDIT_BASED_CONNECTION_RSP (code 0x18) (Page 1143)
  - 4.27 L2CAP_CREDIT_BASED_RECONFIGURE_REQ (code 0x19) (Page 1145)
  - 4.28 L2CAP_CREDIT_BASED_RECONFIGURE_RSP (code 0x1A) (Page 1146)
- 5 Configuration parameter options (Page 1147)
  - 5.1 Maximum Transmission Unit (MTU) (Page 1147)
  - 5.2 Flush Timeout option (Page 1149)
  - 5.3 Quality of Service (QoS) option (Page 1150)
  - 5.4 Retransmission and Flow Control option (Page 1154)
  - 5.5 Frame Check Sequence (FCS) option (Page 1159)
  - 5.6 Extended Flow Specification option (Page 1160)
  - 5.7 Extended Window Size option (Page 1165)
- 6 State machine (Page 1167)
  - 6.1 General rules for the state machine (Page 1167)
    - 6.1.1 CLOSED state (Page 1168)
    - 6.1.2 WAIT_CONNECT_RSP state (Page 1169)
    - 6.1.3 WAIT_CONNECT state (Page 1170)
    - 6.1.4 CONFIG state (Page 1170)
    - 6.1.5 OPEN state (Page 1175)
    - 6.1.6 WAIT_DISCONNECT state (Page 1176)
    - 6.1.7 [This section is no longer used] (Page 1176)
    - 6.1.8 [This section is no longer used] (Page 1176)
    - 6.1.9 [This section is no longer used] (Page 1176)
    - 6.1.10 [This section is no longer used] (Page 1176)
    - 6.1.11 [This section is no longer used] (Page 1176)
    - 6.1.12 [This section is no longer used] (Page 1176)
  - 6.2 Timers events (Page 1176)
    - 6.2.1 RTX (Page 1176)
    - 6.2.2 ERTX (Page 1177)
- 7 General procedures (Page 1180)
  - 7.1 Configuration process (Page 1180)
    - 7.1.1 Request Path (Page 1181)
    - 7.1.2 Response Path (Page 1182)
    - 7.1.3 Lockstep Configuration process (Page 1182)
    - 7.1.4 Standard Configuration process (Page 1185)
  - 7.2 Fragmentation and recombination (Page 1187)
    - 7.2.1 Fragmentation of L2CAP PDUs (Page 1187)
    - 7.2.2 Recombination of L2CAP PDUs (Page 1188)
  - 7.3 Encapsulation of SDUs (Page 1189)
    - 7.3.1 Segmentation of L2CAP SDUs (Page 1189)
    - 7.3.2 Reassembly of L2CAP SDUs (Page 1190)
    - 7.3.3 Segmentation and fragmentation (Page 1190)
  - 7.4 Delivery of erroneous L2CAP SDUs (Page 1191)
  - 7.5 Operation with flushing On ACL-U logical links (Page 1192)
  - 7.6 Connectionless data channel (Page 1193)
  - 7.7 Operation collision resolution (Page 1195)
  - 7.8 [This section is no longer used] (Page 1195)
  - 7.9 Prioritizing data over HCI (Page 1195)
  - 7.10 Supporting Extended Flow Specification for BR/EDR and BR/EDR/LE Controllers (Page 1195)
  - 7.11 Enhanced Credit-Based Flow Control Reconfiguration (Page 1197)
  - 7.12 Operation with flushing on LE-U logical links (Page 1197)
- 8 Procedures for Flow Control and Retransmission (Page 1198)
  - 8.1 Information retrieval (Page 1198)
  - 8.2 Function of PDU Types for Flow Control and Retransmission (Page 1198)
    - 8.2.1 Information frame (I-frame) (Page 1198)
    - 8.2.2 Supervisory frame (S-frame) (Page 1198)
      - 8.2.2.1 Receiver Ready (RR) (Page 1199)
      - 8.2.2.2 Reject (REJ) (Page 1199)
  - 8.3 Variables and sequence numbers (Page 1199)
    - 8.3.1 Sending peer (Page 1200)
      - 8.3.1.1 Send sequence number TxSeq (Page 1200)
      - 8.3.1.2 Send state variable NextTxSeq (Page 1200)
      - 8.3.1.3 Acknowledge state variable ExpectedAckSeq (Page 1200)
    - 8.3.2 Receiving peer (Page 1201)
      - 8.3.2.1 Receive sequence number ReqSeq (Page 1201)
      - 8.3.2.2 Receive state variable ExpectedTxSeq (Page 1202)
      - 8.3.2.3 Buffer state variable BufferSeq (Page 1202)
  - 8.4 Retransmission mode (Page 1203)
    - 8.4.1 Transmitting frames (Page 1203)
      - 8.4.1.1 Last received R was set to zero (Page 1203)
      - 8.4.1.2 Last received R was set to one (Page 1205)
    - 8.4.2 Receiving I-frames (Page 1205)
    - 8.4.3 I-frames pulled by the SDU reassembly function (Page 1205)
    - 8.4.4 Sending and receiving acknowledgments (Page 1205)
      - 8.4.4.1 Sending acknowledgments (Page 1206)
      - 8.4.4.2 Receiving acknowledgments (Page 1206)
    - 8.4.5 Receiving REJ frames (Page 1207)
    - 8.4.6 Waiting acknowledgments (Page 1207)
    - 8.4.7 Exception conditions (Page 1207)
      - 8.4.7.1 TxSeq sequence error (Page 1207)
      - 8.4.7.2 ReqSeq sequence error (Page 1208)
      - 8.4.7.3 Timer recovery error (Page 1208)
      - 8.4.7.4 Invalid frame (Page 1208)
  - 8.5 Flow Control mode (Page 1209)
    - 8.5.1 Transmitting I-frames (Page 1209)
    - 8.5.2 Receiving I-frames (Page 1210)
    - 8.5.3 I-frames pulled by the SDU reassembly function (Page 1210)
    - 8.5.4 Sending and receiving acknowledgments (Page 1210)
      - 8.5.4.1 Sending acknowledgments (Page 1210)
      - 8.5.4.2 Receiving acknowledgments (Page 1211)
    - 8.5.5 Waiting acknowledgments (Page 1211)
    - 8.5.6 Exception conditions (Page 1211)
      - 8.5.6.1 TxSeq sequence error (Page 1211)
      - 8.5.6.2 ReqSeq sequence error (Page 1212)
      - 8.5.6.3 Invalid frame (Page 1212)
  - 8.6 Enhanced Retransmission mode (Page 1212)
    - 8.6.1 Function of PDU types (Page 1213)
      - 8.6.1.1 Receiver Ready (RR) (Page 1213)
      - 8.6.1.2 Reject (REJ) (Page 1213)
      - 8.6.1.3 Receiver Not Ready (RNR) (Page 1213)
      - 8.6.1.4 Selective Reject (SREJ) (Page 1214)
      - 8.6.1.5 Functions of the Poll (P) and Final (F) bits (Page 1214)
    - 8.6.2 Rules for timers (Page 1214)
      - 8.6.2.1 Timer rules for ACL-U logical links (Page 1215)
      - 8.6.2.2 [This section is no longer used] (Page 1215)
      - 8.6.2.3 [This section is no longer used] (Page 1215)
    - 8.6.3 General rules for the state machine (Page 1215)
    - 8.6.4 State diagram (Page 1216)
    - 8.6.5 States tables (Page 1217)
      - 8.6.5.1 State machines (Page 1217)
      - 8.6.5.2 States (Page 1218)
      - 8.6.5.3 Variables and timers (Page 1218)
      - 8.6.5.4 Events (Page 1221)
      - 8.6.5.5 Conditions (Page 1222)
      - 8.6.5.6 Actions (Page 1224)
      - 8.6.5.7 XMIT state table (Page 1229)
      - 8.6.5.8 WAIT_F state table (Page 1230)
      - 8.6.5.9 RECV state table (Page 1230)
      - 8.6.5.10 REJ_SENT state table (Page 1234)
      - 8.6.5.11 SREJ_SENT state table (Page 1237)
  - 8.7 Streaming mode (Page 1241)
    - 8.7.1 Transmitting I-frames (Page 1241)
    - 8.7.2 Receiving I-frames (Page 1241)
    - 8.7.3 Exception conditions (Page 1242)
      - 8.7.3.1 TxSeq sequence error (Page 1242)
- 9 [This section is no longer used] (Page 1243)
- 10 Procedures for Credit Based Flow Control (Page 1244)
  - 10.1 LE Credit Based Flow Control mode (Page 1244)
  - 10.2 Enhanced Credit Based Flow Control Mode (Page 1245)
- Appendix A  Configuration MSCs (Page 1246)
- Appendix B  Changes to signaling packet names (Page 1249)
