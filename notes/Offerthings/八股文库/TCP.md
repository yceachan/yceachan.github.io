# 三次握手

> **SYN 是 TCP 报文头 Flags 字段中的一个 1-bit 控制位**。
>
> 当 SYN=1 时，表示**发起连接**，并用于**同步序列号（Sequence Number）**
>
> Seq 32 位字段,表示当前报文段中数据的第一个字节的序号,在三次握手中，它是随机生成的初始序列号
>
> ACK 32位字段，表示期望收到对方下一个字节的序号

**① 第一次握手：客户端 → 服务端（SYN +SEQ）**

**② 第二次握手：服务端 → 客户端（SYN + ACK）**

**③ 第三次握手：客户端 → 服务端（ACK）**

- 三次握手完成后，双方进入 ESTABLISHED 状态

此时就可以开始：

- HTTP 请求
- MQTT 连接
- TLS 握手

# 断开连接四次挥手

TCP 是**全双工协议**，双方的发送和接收是独立的，因此：

- **关闭发送方向（FIN）** 和
- **确认对方关闭（ACK）**

必须分开进行。

也就是说：

> **每个方向都需要一个 FIN + 一个 ACK，所以总共需要四次挥手。**



**TCP 连接一旦建立，双方都可以同时发送和接收数据（全双工）**

**但服务器/客户端角色在连接建立阶段是固定的，不会互换**

**连接建立后，谁先发数据、谁后发数据都不影响 TCP 会话层的数据传输**